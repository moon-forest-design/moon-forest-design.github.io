<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="../../favicon.ico">
  <link rel="canonical" href="https://moon-forest-design.github.io/yellowredfox/memo-gatsby/17/index.html">
  <title>【GatsbyJS入門】サイドバーにtagsを表示する方法｜キアカラボ</title>
  <meta name="format-detection" content="telephone=no">
  <meta name="description" content="GatsbyJSサイトでサイドバーにtagsを表示する方法。MDX用。">
  <meta name="author" content="イールド（月の森デザイン）">
  <meta property="og:locale" content="ja_JP">
  <meta property="og:site_name" content="キアカラボ">
  <meta property="og:title" content="【GatsbyJS入門】サイドバーにtagsを表示する方法">
  <meta property="og:description" content="GatsbyJSサイトでサイドバーにtagsを表示する方法。MDX用。">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://moon-forest-design.github.io/yellowredfox/memo-gatsby/17/index.html">
  <meta name="robots" content="noindex">
</head>
<body>
  <header class="header">
    <div class="header__inner">
      <h1 class="siteTitle">【GatsbyJS入門】<br class="brNone">サイドバーにtagsを表示する方法</h1>
    </div>
  </header>

  <main class="main">
    <div class="main__inner">


      <section class="contents">
        <h2 id="summary" class="heading-2" data-subheading="A brief description of the process">概要</h2>
        <h3 class="heading-3">要点</h3>
        <section class="content">
          <p>。</p>
          <ol>
            <li>/src/componentsディレクトリ下に sideBar.jsを作成する。このコンポーネントに、カテゴリやタグリストを追加していくイメージ。今回はとりあえず、タグリストだけ入れる。</li>
            <li>/src/componentsディレクトリ下に widgetTags.jsを作成する。前回のコードを流用したところ、エラーが出た。親切なことにどのようにすれば良いかも書かれている。どうやら、ビルディングブロックコンポーネントでは、useStaticQuery()を使いなさいということらしい。クエリを関数外に書いていたら、なかなかうまくいかず、<a href="https://vanilla-note.com/posts/creating-categories-pages/" target="_blank" rel="noopener noreferrer">Vanilla note</a>さんのコードを参考にさせていただくことにした。</li>
          </ol>
        </section>
        <!-- /.content -->
        
        <section class="content">
          <h3 class="heading-3">手順</h3>

          <section>
            <h4 class="heading-4">/src/components/sideBar.js</h4>
<pre class="code">
<code>
import * as React from 'react';
import WidgetTags from './widgetTags';

const SideBar = () =&gt; {
  return (
    &lt;&gt;
      &lt;h2&gt;タグクラウド&lt;/h2&gt;
      &lt;WidgetTags /&gt;
    &lt;/&gt;
  )
};

export default SideBar;
</code>
</pre>
          </section>

          <section>
            <h4 class="heading-4">エラーメッセージ</h4>
<pre class="code">
<code>
warn The GraphQL query in the non-page component
"C:/～（略）～/src/components/widgetTags.js" will not be run.
Exported queries are only executed for Page components. It's possible you're trying to create pages in your gatsby-node.js and that's failing for some reason.

If the failing component(s) is a regular component and not intended to be a page component, you generally want to use a &lt;StaticQuery&gt; (https://gatsbyjs.org/docs/static-query) instead of exporting a page query.

If you're more experienced with GraphQL, you can also export GraphQL fragments from components and compose the fragments in the Page component query and pass data down into the child component ? https://graphql.org/learn/queries/#fragments
</code>
</pre>
          </section>

          <section>
            <h4 class="heading-4">/src/components/widgetTags.js</h4>
<pre class="code">
<code>
import * as React from 'react';
import PropTypes from 'prop-types';
import kebabCase from 'lodash/kebabCase';
import { Link, graphql, useStaticQuery } from 'gatsby';

const WidgetTags = () =&gt; {
  const query = useStaticQuery(graphql`
    query {
      allMdx(limit: 100) {
        group(field: frontmatter___tags) {
          fieldValue
          totalCount
        }
      }
    }
  `);
  const group = query.allMdx.group.sort(
    (a, b) =&gt; b.totalCount - a.totalCount
  );
  return (
    &lt;ul className={style.tagList}&gt;
      {group.map(tag =&gt; (
        &lt;li key={tag.fieldValue}&gt;
          &lt;Link to={`/tags/${kebabCase(tag.fieldValue)}/`}&gt;
            {tag.fieldValue} ({tag.totalCount})
          &lt;/Link&gt;
        &lt;/li&gt;
      ))}
    &lt;/ul&gt;
  )
};

WidgetTags.propTypes = {
  data: PropTypes.shape({
    allMdx: PropTypes.shape({
      group: PropTypes.arrayOf(
        PropTypes.shape({
          fieldValue: PropTypes.string.isRequired,
          totalCount: PropTypes.number.isRequired,
        }).isRequired
      ),
    }),
  }),
};

export default WidgetTags;
</code>
</pre>
          </section>


      </section>
      <!-- /.content -->

      </section>
      <!-- /.contents -->

      <section class="contents">
        <h2 class="heading-2" data-subheading="Editor's Note and Document that I used as a reference">編集後記</h2>
        <section class="content">
          <h3 class="heading-3">あとがき</h3>
          <ul>
            <li>header.jsや seo.jsではクエリを関数外に書けたのだが、さてはて。</li>
          </ul>
        </section>
        <!-- /.content -->
        <section class="content">
          <h3 class="heading-3">参考資料</h3>
          <p>参考にさせていただきました。ありがとうございました。</p>
          <ul>
            <li><a href="https://www.gatsbyjs.com/docs/adding-tags-and-categories-to-blog-posts/" target="_blank" rel="noopener noreferrer">Creating Tags Pages for Blog Posts | Gatsby</a></li>
            <li><a href="https://vanilla-note.com/posts/creating-categories-pages/" target="_blank" rel="noopener noreferrer">GatsbyJSサイトにカテゴリー一覧を追加 | Vanilla note</a></li>
          </ul>
        </section>
        <!-- /.content -->
      </section>
      <!-- /.contents -->
      
      <div class="postFooter">
        <div class="postDate">
          作成日: <time class="releaseDate" datetime="2021-11-11">2021年11月11日</time>
        </div>
        <div class="postAuthor">
          作成者: イールド
        </div>
      </div>
      <!-- /.postFooter -->

    </div>
    <!-- /.main__inner -->
  </main>
  
  <footer class="footer">
    <div class="footer__inner">
      <div class="profile">
        <div class="backSignboard">
          <a class="backSignboard__link" href="https://moon-forest-design.github.io/yellowredfox/index.html">
            <img class="backSignboard__logo" src="../../img/logo-yellowredfox.png" alt="月の森デザインの漫画キャラクター：黄赤 狐のプロフィールロゴ" width="100" height="100">
            <h2 class="backSignboard__title">キアカラボ</h2>
          </a>
        </div>
        <p class="office">
          「<a href="https://moon-forest-design.com/" title="ホームページ制作の「月の森デザイン」" target="_blank" rel="noopener noreferrer">月の森デザイン</a>」のプログラミング研究室
        </p>
      </div>
      <div class="copyright">
        <p><small>Copyright &copy; 2021 <a class="copyrightHolder" href="https://moon-forest-design.com/" target="_blank" rel="noopener noreferrer">月の森デザイン</a> All Rights Reserved.</small></p>
      </div>
    </div>
  </footer>

</body>
</html>
